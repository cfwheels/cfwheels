(function(t){t.qjax=function(o){var n=t.extend({timeout:null,onStart:null,onStop:null,onError:null,onTimeout:null,onQueueChange:null,queueChangeDelay:0,ajaxSettings:{contentType:"application/x-www-form-urlencoded; charset=UTF-8",type:"GET"}},o),e=[],i=null,r=null,u=this,s=!1,l=function(){s||(s=!0,n.onTimeout&&n.timeout&&t.isFunction(n.onTimeout)&&(r&&clearTimeout(r),r=setTimeout(t.proxy(function(){n.onTimeout.call(this,i.options)},this),n.timeout)),n.onStart&&t.isFunction(n.onStart)&&n.onStart(this,i.options))},a=function(){s&&0>=e.length&&(s=!1,r&&clearTimeout(r),n.onStop&&t.isFunction(n.onStop)&&n.onStop(this,i.options))},p=function(){if(n.onQueueChange&&n.onQueueChange.call(u,e.length),e.length>=1&&!i)if(i=e.shift(),i.options.isCallback)i.options.complete();else{l();var o=t.ajax(i.options);for(var r in i.promise)for(var s in i.promise[r])o[r].call(this,i.promise[r][s])}},c=function(t,o,n){this.options=t,this.complete=o,this.context=n,this.promise={done:[],then:[],always:[],fail:[]}};return c.prototype._promise=function(t,o){return this.promise[t]&&this.promise[t].push(o),this},c.prototype.done=function(t){return this._promise("done",t)},c.prototype.then=function(t){return this._promise("then",t)},c.prototype.always=function(t){return this._promise("always",t)},c.prototype.fail=function(t){return this._promise("fail",t)},this.Clear=function(){e=[]},this.Queue=function(o,r){var u={},s=null;o instanceof Function?(u={isCallback:!0},s=o):(u=t.extend({},n.ajaxSettings,o||{}),s=u.complete),u.complete=function(o,e){"error"==e&&n.onError&&t.isFunction(n.onError)&&n.onError.call(i.context||this,o,e),i&&(i.complete&&i.complete.call(i.context||this,o,e),a(),i=null,p())};var o=new c(u,s,r);return e.push(o),setTimeout(p,n.queueChangeDelay),o},this}})(jQuery);
